{"/home/circleci/repo/src/file.ts": {"path":"/home/circleci/repo/src/file.ts","statementMap":{"0":{"start":{"line":2,"column":37},"end":{"line":31,"column":3}},"1":{"start":{"line":4,"column":8},"end":{"line":4,"column":25}},"2":{"start":{"line":6,"column":4},"end":{"line":19,"column":6}},"3":{"start":{"line":7,"column":18},"end":{"line":7,"column":50}},"4":{"start":{"line":8,"column":8},"end":{"line":18,"column":9}},"5":{"start":{"line":10,"column":16},"end":{"line":10,"column":53}},"6":{"start":{"line":12,"column":16},"end":{"line":12,"column":62}},"7":{"start":{"line":15,"column":16},"end":{"line":15,"column":57}},"8":{"start":{"line":17,"column":16},"end":{"line":17,"column":82}},"9":{"start":{"line":20,"column":4},"end":{"line":29,"column":6}},"10":{"start":{"line":21,"column":22},"end":{"line":21,"column":39}},"11":{"start":{"line":22,"column":8},"end":{"line":27,"column":9}},"12":{"start":{"line":23,"column":12},"end":{"line":23,"column":49}},"13":{"start":{"line":26,"column":12},"end":{"line":26,"column":66}},"14":{"start":{"line":28,"column":8},"end":{"line":28,"column":33}},"15":{"start":{"line":30,"column":4},"end":{"line":30,"column":27}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":2,"column":37},"end":{"line":2,"column":38}},"loc":{"start":{"line":2,"column":49},"end":{"line":31,"column":1}},"line":2},"1":{"name":"StackOutputFile","decl":{"start":{"line":3,"column":13},"end":{"line":3,"column":28}},"loc":{"start":{"line":3,"column":35},"end":{"line":5,"column":5}},"line":3},"2":{"name":"(anonymous_2)","decl":{"start":{"line":6,"column":39},"end":{"line":6,"column":40}},"loc":{"start":{"line":6,"column":55},"end":{"line":19,"column":5}},"line":6},"3":{"name":"(anonymous_3)","decl":{"start":{"line":20,"column":37},"end":{"line":20,"column":38}},"loc":{"start":{"line":20,"column":53},"end":{"line":29,"column":5}},"line":20}},"branchMap":{"0":{"loc":{"start":{"line":7,"column":18},"end":{"line":7,"column":50}},"type":"binary-expr","locations":[{"start":{"line":7,"column":18},"end":{"line":7,"column":44}},{"start":{"line":7,"column":48},"end":{"line":7,"column":50}}],"line":7},"1":{"loc":{"start":{"line":8,"column":8},"end":{"line":18,"column":9}},"type":"switch","locations":[{"start":{"line":9,"column":12},"end":{"line":10,"column":53}},{"start":{"line":11,"column":12},"end":{"line":12,"column":62}},{"start":{"line":13,"column":12},"end":{"line":13,"column":24}},{"start":{"line":14,"column":12},"end":{"line":15,"column":57}},{"start":{"line":16,"column":12},"end":{"line":17,"column":82}}],"line":8}},"s":{"0":2,"1":6,"2":2,"3":5,"4":5,"5":1,"6":1,"7":2,"8":1,"9":2,"10":0,"11":0,"12":0,"13":0,"14":0,"15":2},"f":{"0":2,"1":6,"2":5,"3":0},"b":{"0":[5,0],"1":[1,1,1,2,1]},"inputSourceMap":{"version":3,"file":"file.js","sourceRoot":"","sources":["file.ts"],"names":[],"mappings":"AAAA,OAAO,KAAK,EAAE,MAAM,IAAI,CAAA;AAExB;IACE,yBACS,IAAY;QAAZ,SAAI,GAAJ,IAAI,CAAQ;IACjB,CAAC;IAEE,gCAAM,GAAb,UAAe,IAAY;QACzB,IAAM,GAAG,GAAG,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,GAAG,EAAE,IAAI,EAAE,CAAA;QAE5C,MAAM,CAAC,CAAC,GAAG,CAAC,WAAW,EAAE,CAAC,CAAC,CAAC;YAC1B,KAAK,MAAM;gBACT,MAAM,CAAC,IAAI,CAAC,SAAS,CAAC,IAAI,EAAE,IAAI,EAAE,CAAC,CAAC,CAAA;YACtC,KAAK,MAAM;gBACT,MAAM,CAAC,OAAO,CAAC,cAAc,CAAC,CAAC,IAAI,EAAE,IAAI,EAAE,CAAC,CAAC,CAAA;YAC/C,KAAK,MAAM,CAAC;YACZ,KAAK,KAAK;gBACR,MAAM,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC,SAAS,CAAC,IAAI,CAAC,CAAA;YAC1C;gBACE,MAAM,IAAI,KAAK,CAAC,0BAA0B,GAAG,GAAG,GAAG,aAAa,CAAC,CAAA;QACrE,CAAC;IACH,CAAC;IAEM,8BAAI,GAAX,UAAa,IAAY;QACvB,IAAM,OAAO,GAAG,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,CAAA;QAEjC,IAAI,CAAC;YACH,EAAE,CAAC,aAAa,CAAC,IAAI,CAAC,IAAI,EAAE,OAAO,CAAC,CAAA;QACtC,CAAC;QAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;YACX,MAAM,IAAI,KAAK,CAAC,wBAAwB,GAAG,IAAI,CAAC,IAAI,CAAC,CAAA;QACvD,CAAC;QAED,MAAM,CAAC,OAAO,CAAC,OAAO,EAAE,CAAA;IAC1B,CAAC;IACH,sBAAC;AAAD,CAAC,AAhCD,IAgCC","sourcesContent":["import * as fs from 'fs'\n\nexport default class StackOutputFile {\n  constructor (\n    public path: string\n  ) { }\n\n  public format (data: object) {\n    const ext = this.path.split('.').pop() || ''\n\n    switch (ext.toUpperCase()) {\n      case 'JSON':\n        return JSON.stringify(data, null, 2)\n      case 'TOML':\n        return require('tomlify-j0.4')(data, null, 0)\n      case 'YAML':\n      case 'YML':\n        return require('yamljs').stringify(data)\n      default:\n        throw new Error('No formatter found for `' + ext + '` extension')\n    }\n  }\n\n  public save (data: object) {\n    const content = this.format(data)\n\n    try {\n      fs.writeFileSync(this.path, content)\n    } catch (e) {\n      throw new Error('Cannot write to file: ' + this.path)\n    }\n\n    return Promise.resolve()\n  }\n}\n"]},"_coverageSchema":"332fd63041d2c1bcb487cc26dd0d5f7d97098a6c","hash":"98cab1eaa87bcc2a10f8c31d06e9f194cf3c879b"}
,"/home/circleci/repo/src/plugin.ts": {"path":"/home/circleci/repo/src/plugin.ts","statementMap":{"0":{"start":{"line":4,"column":39},"end":{"line":96,"column":3}},"1":{"start":{"line":6,"column":8},"end":{"line":6,"column":37}},"2":{"start":{"line":7,"column":8},"end":{"line":7,"column":31}},"3":{"start":{"line":8,"column":8},"end":{"line":10,"column":10}},"4":{"start":{"line":11,"column":8},"end":{"line":11,"column":60}},"5":{"start":{"line":13,"column":4},"end":{"line":19,"column":7}},"6":{"start":{"line":15,"column":12},"end":{"line":15,"column":42}},"7":{"start":{"line":20,"column":4},"end":{"line":26,"column":7}},"8":{"start":{"line":22,"column":12},"end":{"line":22,"column":45}},"9":{"start":{"line":27,"column":4},"end":{"line":33,"column":7}},"10":{"start":{"line":29,"column":12},"end":{"line":29,"column":129}},"11":{"start":{"line":34,"column":4},"end":{"line":36,"column":6}},"12":{"start":{"line":35,"column":8},"end":{"line":35,"column":51}},"13":{"start":{"line":37,"column":4},"end":{"line":39,"column":6}},"14":{"start":{"line":38,"column":8},"end":{"line":38,"column":41}},"15":{"start":{"line":40,"column":4},"end":{"line":42,"column":6}},"16":{"start":{"line":41,"column":8},"end":{"line":41,"column":38}},"17":{"start":{"line":43,"column":4},"end":{"line":45,"column":6}},"18":{"start":{"line":44,"column":8},"end":{"line":44,"column":90}},"19":{"start":{"line":46,"column":4},"end":{"line":52,"column":6}},"20":{"start":{"line":47,"column":21},"end":{"line":47,"column":44}},"21":{"start":{"line":48,"column":19},"end":{"line":48,"column":37}},"22":{"start":{"line":49,"column":19},"end":{"line":49,"column":35}},"23":{"start":{"line":50,"column":8},"end":{"line":50,"column":65}},"24":{"start":{"line":51,"column":8},"end":{"line":51,"column":33}},"25":{"start":{"line":53,"column":4},"end":{"line":56,"column":6}},"26":{"start":{"line":54,"column":16},"end":{"line":54,"column":46}},"27":{"start":{"line":55,"column":8},"end":{"line":55,"column":28}},"28":{"start":{"line":57,"column":4},"end":{"line":59,"column":6}},"29":{"start":{"line":58,"column":8},"end":{"line":58,"column":220}},"30":{"start":{"line":60,"column":4},"end":{"line":67,"column":6}},"31":{"start":{"line":61,"column":20},"end":{"line":61,"column":56}},"32":{"start":{"line":62,"column":21},"end":{"line":62,"column":40}},"33":{"start":{"line":63,"column":8},"end":{"line":66,"column":15}},"34":{"start":{"line":64,"column":12},"end":{"line":64,"column":94}},"35":{"start":{"line":68,"column":4},"end":{"line":73,"column":6}},"36":{"start":{"line":69,"column":8},"end":{"line":72,"column":11}},"37":{"start":{"line":74,"column":4},"end":{"line":77,"column":6}},"38":{"start":{"line":75,"column":20},"end":{"line":75,"column":24}},"39":{"start":{"line":76,"column":8},"end":{"line":76,"column":213}},"40":{"start":{"line":76,"column":78},"end":{"line":76,"column":188}},"41":{"start":{"line":78,"column":4},"end":{"line":81,"column":6}},"42":{"start":{"line":79,"column":20},"end":{"line":79,"column":24}},"43":{"start":{"line":80,"column":8},"end":{"line":80,"column":195}},"44":{"start":{"line":80,"column":72},"end":{"line":80,"column":170}},"45":{"start":{"line":82,"column":4},"end":{"line":89,"column":6}},"46":{"start":{"line":83,"column":8},"end":{"line":83,"column":68}},"47":{"start":{"line":84,"column":8},"end":{"line":84,"column":76}},"48":{"start":{"line":85,"column":8},"end":{"line":85,"column":85}},"49":{"start":{"line":86,"column":8},"end":{"line":86,"column":90}},"50":{"start":{"line":87,"column":8},"end":{"line":87,"column":99}},"51":{"start":{"line":88,"column":8},"end":{"line":88,"column":99}},"52":{"start":{"line":90,"column":4},"end":{"line":94,"column":6}},"53":{"start":{"line":91,"column":20},"end":{"line":91,"column":24}},"54":{"start":{"line":92,"column":8},"end":{"line":93,"column":329}},"55":{"start":{"line":93,"column":32},"end":{"line":93,"column":56}},"56":{"start":{"line":93,"column":79},"end":{"line":93,"column":100}},"57":{"start":{"line":93,"column":126},"end":{"line":93,"column":153}},"58":{"start":{"line":93,"column":179},"end":{"line":93,"column":204}},"59":{"start":{"line":93,"column":231},"end":{"line":93,"column":325}},"60":{"start":{"line":95,"column":4},"end":{"line":95,"column":29}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":4,"column":39},"end":{"line":4,"column":40}},"loc":{"start":{"line":4,"column":51},"end":{"line":96,"column":1}},"line":4},"1":{"name":"StackOutputPlugin","decl":{"start":{"line":5,"column":13},"end":{"line":5,"column":30}},"loc":{"start":{"line":5,"column":52},"end":{"line":12,"column":5}},"line":5},"2":{"name":"(anonymous_2)","decl":{"start":{"line":14,"column":13},"end":{"line":14,"column":14}},"loc":{"start":{"line":14,"column":25},"end":{"line":16,"column":9}},"line":14},"3":{"name":"(anonymous_3)","decl":{"start":{"line":21,"column":13},"end":{"line":21,"column":14}},"loc":{"start":{"line":21,"column":25},"end":{"line":23,"column":9}},"line":21},"4":{"name":"(anonymous_4)","decl":{"start":{"line":28,"column":13},"end":{"line":28,"column":14}},"loc":{"start":{"line":28,"column":25},"end":{"line":30,"column":9}},"line":28},"5":{"name":"(anonymous_5)","decl":{"start":{"line":34,"column":44},"end":{"line":34,"column":45}},"loc":{"start":{"line":34,"column":59},"end":{"line":36,"column":5}},"line":34},"6":{"name":"(anonymous_6)","decl":{"start":{"line":37,"column":45},"end":{"line":37,"column":46}},"loc":{"start":{"line":37,"column":57},"end":{"line":39,"column":5}},"line":37},"7":{"name":"(anonymous_7)","decl":{"start":{"line":40,"column":42},"end":{"line":40,"column":43}},"loc":{"start":{"line":40,"column":54},"end":{"line":42,"column":5}},"line":40},"8":{"name":"(anonymous_8)","decl":{"start":{"line":43,"column":44},"end":{"line":43,"column":45}},"loc":{"start":{"line":43,"column":59},"end":{"line":45,"column":5}},"line":43},"9":{"name":"(anonymous_9)","decl":{"start":{"line":46,"column":46},"end":{"line":46,"column":47}},"loc":{"start":{"line":46,"column":62},"end":{"line":52,"column":5}},"line":46},"10":{"name":"(anonymous_10)","decl":{"start":{"line":53,"column":43},"end":{"line":53,"column":44}},"loc":{"start":{"line":53,"column":59},"end":{"line":56,"column":5}},"line":53},"11":{"name":"(anonymous_11)","decl":{"start":{"line":57,"column":40},"end":{"line":57,"column":41}},"loc":{"start":{"line":57,"column":52},"end":{"line":59,"column":5}},"line":57},"12":{"name":"(anonymous_12)","decl":{"start":{"line":60,"column":43},"end":{"line":60,"column":44}},"loc":{"start":{"line":60,"column":59},"end":{"line":67,"column":5}},"line":60},"13":{"name":"(anonymous_13)","decl":{"start":{"line":63,"column":29},"end":{"line":63,"column":30}},"loc":{"start":{"line":63,"column":50},"end":{"line":66,"column":9}},"line":63},"14":{"name":"(anonymous_14)","decl":{"start":{"line":68,"column":41},"end":{"line":68,"column":42}},"loc":{"start":{"line":68,"column":57},"end":{"line":73,"column":5}},"line":68},"15":{"name":"(anonymous_15)","decl":{"start":{"line":74,"column":48},"end":{"line":74,"column":49}},"loc":{"start":{"line":74,"column":64},"end":{"line":77,"column":5}},"line":74},"16":{"name":"(anonymous_16)","decl":{"start":{"line":76,"column":64},"end":{"line":76,"column":65}},"loc":{"start":{"line":76,"column":76},"end":{"line":76,"column":190}},"line":76},"17":{"name":"(anonymous_17)","decl":{"start":{"line":78,"column":45},"end":{"line":78,"column":46}},"loc":{"start":{"line":78,"column":61},"end":{"line":81,"column":5}},"line":78},"18":{"name":"(anonymous_18)","decl":{"start":{"line":80,"column":58},"end":{"line":80,"column":59}},"loc":{"start":{"line":80,"column":70},"end":{"line":80,"column":172}},"line":80},"19":{"name":"(anonymous_19)","decl":{"start":{"line":82,"column":43},"end":{"line":82,"column":44}},"loc":{"start":{"line":82,"column":55},"end":{"line":89,"column":5}},"line":82},"20":{"name":"(anonymous_20)","decl":{"start":{"line":90,"column":42},"end":{"line":90,"column":43}},"loc":{"start":{"line":90,"column":54},"end":{"line":94,"column":5}},"line":90},"21":{"name":"(anonymous_21)","decl":{"start":{"line":93,"column":18},"end":{"line":93,"column":19}},"loc":{"start":{"line":93,"column":30},"end":{"line":93,"column":58}},"line":93},"22":{"name":"(anonymous_22)","decl":{"start":{"line":93,"column":65},"end":{"line":93,"column":66}},"loc":{"start":{"line":93,"column":77},"end":{"line":93,"column":102}},"line":93},"23":{"name":"(anonymous_23)","decl":{"start":{"line":93,"column":109},"end":{"line":93,"column":110}},"loc":{"start":{"line":93,"column":124},"end":{"line":93,"column":155}},"line":93},"24":{"name":"(anonymous_24)","decl":{"start":{"line":93,"column":162},"end":{"line":93,"column":163}},"loc":{"start":{"line":93,"column":177},"end":{"line":93,"column":206}},"line":93},"25":{"name":"(anonymous_25)","decl":{"start":{"line":93,"column":214},"end":{"line":93,"column":215}},"loc":{"start":{"line":93,"column":229},"end":{"line":93,"column":327}},"line":93}},"branchMap":{"0":{"loc":{"start":{"line":35,"column":15},"end":{"line":35,"column":50}},"type":"binary-expr","locations":[{"start":{"line":35,"column":15},"end":{"line":35,"column":28}},{"start":{"line":35,"column":32},"end":{"line":35,"column":50}}],"line":35},"1":{"loc":{"start":{"line":48,"column":19},"end":{"line":48,"column":37}},"type":"binary-expr","locations":[{"start":{"line":48,"column":19},"end":{"line":48,"column":31}},{"start":{"line":48,"column":35},"end":{"line":48,"column":37}}],"line":48},"2":{"loc":{"start":{"line":61,"column":20},"end":{"line":61,"column":56}},"type":"binary-expr","locations":[{"start":{"line":61,"column":20},"end":{"line":61,"column":37}},{"start":{"line":61,"column":41},"end":{"line":61,"column":56}}],"line":61},"3":{"loc":{"start":{"line":62,"column":21},"end":{"line":62,"column":40}},"type":"binary-expr","locations":[{"start":{"line":62,"column":21},"end":{"line":62,"column":34}},{"start":{"line":62,"column":38},"end":{"line":62,"column":40}}],"line":62},"4":{"loc":{"start":{"line":76,"column":15},"end":{"line":76,"column":212}},"type":"cond-expr","locations":[{"start":{"line":76,"column":36},"end":{"line":76,"column":191}},{"start":{"line":76,"column":195},"end":{"line":76,"column":212}}],"line":76},"5":{"loc":{"start":{"line":80,"column":15},"end":{"line":80,"column":194}},"type":"cond-expr","locations":[{"start":{"line":80,"column":33},"end":{"line":80,"column":173}},{"start":{"line":80,"column":177},"end":{"line":80,"column":194}}],"line":80},"6":{"loc":{"start":{"line":88,"column":15},"end":{"line":88,"column":53}},"type":"binary-expr","locations":[{"start":{"line":88,"column":15},"end":{"line":88,"column":27}},{"start":{"line":88,"column":31},"end":{"line":88,"column":53}}],"line":88}},"s":{"0":1,"1":2,"2":2,"3":2,"4":2,"5":1,"6":1,"7":1,"8":1,"9":1,"10":0,"11":1,"12":4,"13":1,"14":2,"15":1,"16":2,"17":1,"18":2,"19":1,"20":0,"21":0,"22":0,"23":0,"24":0,"25":1,"26":0,"27":0,"28":1,"29":0,"30":1,"31":0,"32":0,"33":0,"34":0,"35":1,"36":0,"37":1,"38":0,"39":0,"40":0,"41":1,"42":0,"43":0,"44":0,"45":1,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":1,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":1},"f":{"0":1,"1":2,"2":1,"3":1,"4":0,"5":4,"6":2,"7":2,"8":2,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0},"b":{"0":[4,4],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0]},"inputSourceMap":{"version":3,"file":"plugin.js","sourceRoot":"","sources":["plugin.ts"],"names":[],"mappings":"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","sourcesContent":["import * as assert from 'assert'\nimport * as util from 'util'\n\nimport StackOutputFile from './file'\n\nexport default class StackOutputPlugin {\n  public hooks: {}\n  private output: OutputConfig\n\n  constructor (\n    private serverless: Serverless,\n    private options: Serverless.Options\n  ) {\n    this.hooks = {\n      'after:deploy:deploy': this.process.bind(this)\n    }\n\n    this.output = this.serverless.service.custom.output\n  }\n\n  get file () {\n    return this.getConfig('file')\n  }\n\n  get handler () {\n    return this.getConfig('handler')\n  }\n\n  get stackName () {\n    return util.format('%s-%s',\n      this.serverless.service.getServiceName(),\n      this.serverless.getProvider('aws').getStage()\n    )\n  }\n\n  private hasConfig (key: string) {\n    return !!this.output && !!this.output[key]\n  }\n\n  private hasHandler () {\n    return this.hasConfig('handler')\n  }\n\n  private hasFile () {\n    return this.hasConfig('file')\n  }\n\n  private getConfig (key: string) {\n    return util.format('%s/%s',\n      this.serverless.config.servicePath,\n      this.output[key]\n    )\n  }\n\n  private callHandler (data: object) {\n    const splits = this.handler.split('.')\n    const func = splits.pop() || ''\n    const file = splits.join('.')\n\n    require(file)[func](\n      data,\n      this.serverless,\n      this.options\n    )\n\n    return Promise.resolve()\n  }\n\n  private saveFile (data: object) {\n    const f = new StackOutputFile(this.file)\n\n    return f.save(data)\n  }\n\n  private fetch (): Promise<StackDescriptionList> {\n    return this.serverless.getProvider('aws').request(\n      'CloudFormation',\n      'describeStacks',\n      { StackName: this.stackName },\n      this.serverless.getProvider('aws').getStage(),\n      this.serverless.getProvider('aws').getRegion()\n    )\n  }\n\n  private beautify (data: {Stacks: Array<{ Outputs: StackOutputPair[] }>}) {\n    const stack = data.Stacks.pop() || { Outputs: [] }\n    const output = stack.Outputs || []\n\n    return output.reduce(\n      (obj, item: StackOutputPair) => (\n        Object.assign(obj, { [item.OutputKey]: item.OutputValue })\n      ), {}\n    )\n  }\n\n  private handle (data: object) {\n    return Promise.all(\n      [\n        this.handleHandler(data),\n        this.handleFile(data)\n      ]\n    )\n  }\n\n  private handleHandler(data: object) {\n    return this.hasHandler() ? (\n      this.callHandler(\n        data\n      ).then(\n        () => this.serverless.cli.log(\n          util.format('Stack Output processed with handler: %s', this.output.handler)\n        )\n      )\n    ) : Promise.resolve()\n  }\n\n  private handleFile(data: object) {\n    return this.hasFile() ? (\n      this.saveFile(\n        data\n      ).then(\n        () => this.serverless.cli.log(\n          util.format('Stack Output saved to file: %s', this.output.file)\n        )\n      )\n    ) : Promise.resolve()\n  }\n\n  private validate () {\n    assert(this.serverless, 'Invalid serverless configuration')\n    assert(this.serverless.service, 'Invalid serverless configuration')\n    assert(this.serverless.service.provider, 'Invalid serverless configuration')\n    assert(this.serverless.service.provider.name, 'Invalid serverless configuration')\n    assert(this.serverless.service.provider.name === 'aws', 'Only supported for AWS provider')\n\n    assert(this.options && !this.options.noDeploy, 'Skipping deployment with --noDeploy flag')\n  }\n\n  private process () {\n    Promise.resolve()\n    .then(\n      () => this.validate()\n    ).then(\n      () => this.fetch()\n    ).then(\n      (res) => this.beautify(res)\n    ).then(\n      (res) => this.handle(res)\n    ).catch(\n      (err) => this.serverless.cli.log(\n        util.format('Cannot process Stack Output: %s!', err.message)\n      )\n    )\n  }\n}\n"]},"_coverageSchema":"332fd63041d2c1bcb487cc26dd0d5f7d97098a6c","hash":"b2af0b391b3fe34474760c8e3c204ea7f62dc959"}
}
